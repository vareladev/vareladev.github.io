
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>PL/SQL</title>
  <link rel="stylesheet" type="text/css" href="../css/style.css"/>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/claat-public/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="laboratorio-02"
                  title="PL/SQL"
                  environment="web"
                  feedback-link="https://github.com/vareladev/vareladev.github.io/issues">
    
      <google-codelab-step label="Objetivos." duration="3">
        <ul>
<li>Conocer la sintaxis de las funciones, procedimientos y triggers en Oracle.</li>
<li>Utilizar la salida de pantalla con ayuda de DBMS output.</li>
<li>Crear distintos tipos de sentencias como Estructuras de control básicas, funciones, procedimientos almacenados, triggers y bloques anónimos.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Herramientas" duration="6">
        <p>Para esta práctica se utilizarán las siguientes herramientas:</p>
<h2 is-upgraded>Oracle DB 19C</h2>
<p><img alt="image" title="Oracle version" class="img-aside" src="img\\cb25e2ad3dba5ddf.png"> Oracle Database es un sistema de gestión de base de datos de tipo objeto-relacional (ORDBMS, por el acrónimo en inglés de Object-Relational Data Base Management System), desarrollado por Oracle Corporation. Oracle Database 19c es la versión actual a largo plazo, que además proporciona el nivel más alto de estabilidad de la versión y el plazo más largo para asistencia y corrección de errores.</p>
<h2 is-upgraded>SQL Developer</h2>
<p><img alt="image" title="SQL icon" class="icon-aside" src="img\\8c98274a2bc0d2ff.png"> Es una interfaz gráfica de usuario gratuita que permite a los usuarios y administradores de bases de datos realizar sus tareas con menos clicks y pulsaciones de teclas. SQL Developer es una herramienta de productividad cuyo objetivo principal es ayudar al usuario final a ahorrar tiempo y maximizar el retorno de la inversión en el paquete de tecnología de Oracle Database.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Introducción." duration="0">
        <p>Duration 0:2:00</p>
<p>En esta guía se dará a conocer que es el PL/SQL a profundidad, los diversos tipos de datos que existen en el gestor, cómo podremos ser capaces de mostrar salida de pantalla, a su vez conoceremos la sintaxis básica de las distintas sentencias que se pueden utilizar en Oracle.</p>


      </google-codelab-step>
    
      <google-codelab-step label="¿Qué es PL/SQL?" duration="0">
        <p>Duration 0:20:00</p>
<h2 is-upgraded>Definición</h2>
<p>PL/SQL es un lenguaje de procedimiento diseñado específicamente para abarcar sentencias SQL dentro de su sintaxis. El servidor de Oracle Database compila las unidades de programa PL/SQL y se almacenan dentro de la base de datos. Y en tiempo de ejecución, tanto PL/SQL como SQL se ejecutan dentro del mismo proceso de servidor, brindando una eficiencia óptima. PL/SQL hereda automáticamente la robustez, la seguridad y la portabilidad de Oracle Database.</p>
<h2 is-upgraded>Tipos de datos</h2>
<p>En Oracle existen varios tipos de datos, los tipos más comunes en un programa son: number, varchar2, date, Boolean. <img alt="image" title="Data types" src="img\\6a347aa7d99874df.png"></p>
<h2 is-upgraded>Bloques anónimos</h2>
<p>Los bloques anónimos no tienen ningún nombre concreto, por eso de anónimos. Un bloque PL/SQL es definido por las palabras clave DECLARE, BEGIN, EXCEPTION, y END, que dividen el bloque en tres secciones</p>
<ul>
<li>Declare: Se definen los distintos objetos que se van a utilizar en el bloque (variables, constantes, cursores, etcétera). Esta sección es opcional.</li>
<li>Begin: En esta zona estará el código PL/SQL que ejecutaremos.</li>
<li>Exception: Es una sección opcional donde se tratan todos los errores que puedan surgir a la hora de ejecutar las sentencias SQL y PL/SQL de la sección de instrucciones.</li>
<li>End: Indica el cierre del bloque anónimo.</li>
</ul>
<p>Un bloque es en sí mismo una sentencia ejecutable, por lo que se pueden anidar los bloques unos dentro de otros.</p>
<p>Sintaxis:</p>
<pre><code>DECLARE
    --Declaración de variable
BEGIN
    --Instrucciones PL/SQL
EXCEPTION
    --Tratamiento de excepciones
END;
</code></pre>
<h2 is-upgraded>Declaración de variables y constantes</h2>
<ul>
<li>Variables: Las variables son nombres para procesar los elementos de los datos.</li>
</ul>
<p>Sintaxis:</p>
<pre><code>Nombre_variable tipo [NOT NULL] [:= valor | DEFAULT valor]
</code></pre>
<ul>
<li>Constantes: Las constantes son como las variables, pero no puede modificarse su valor.</li>
</ul>
<p>Sintaxis:</p>
<pre><code>Nombre_constante CONSTANT tipo_de_dato := valor
</code></pre>
<aside class="special"><p> El signo de &#34;:=&#34; y &#34;DEFAULT&#34; tienen la misma función. Si ponemos NOT NULL es obligatorio inicializar la variable.  </p>
</aside>
<h2 is-upgraded>Guardar valores a partir de una consulta SELECT.</h2>
<p>Al tener una tabla origen, podemos insertar los datos de dicha tabla a una nueva tabla destino. Se puede elegir ciertos campos de la tabla o bien se pueden insertar todos, teniendo en cuenta que ambas tienen que tener los mismos capos con su mismo tipo de dato.</p>
<p>Sintaxis:</p>
<pre><code>INSERT INTO nombre_tabla SELECT * FROM nombre_tabla_fuente
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Salida de pantalla DBMS Output." duration="2">
        <p>Al haber iniciado SQL Developer daremos en la opción &#34;Ver&#34;. <img alt="image" title="Oracle start" src="img\\c2a6ab2062e81959.png"></p>
<p>Posteriormente se seleccionará la opción de &#34;salida DBMS&#34;. <img alt="image" title="DBMS output" src="img\\c29b94b69a8f3b06.png"></p>
<p>Luego podremos imprimir valores en consola dándole en ejecutar. <img alt="image" title="Console" src="img\\7201cb7af7c21870.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Estructuras de control básicas." duration="0">
        <h2 is-upgraded>IF/THEN/ELSE</h2>
<p>Esta sentencia es utilizada cuando se quiere elegir entre dos opciones basadas en una condición.</p>
<p>Sintaxis:</p>
<pre><code>IF condition THEN
    {-- Código a ejecutar si la condición es verdadera... }

ELSE
    {-- Códifo a ejecutar si la condición es false... }
END IF;
</code></pre>
<h2 is-upgraded>LOOP/EXIT WHEN</h2>
<p>La sentencia loop es la encargada de ejecutar una secuencia de sentencias múltiples veces, PL/SQL nos permite utilizar diversas formas de loops, tales como BASIC LOOP, WHILE LOOP, FOR LOOP y Cursor FOR LOOP. Para salir de un loop podemos utilizar EXIT o EXIT-WHEN.</p>
<p>Sintaxis:</p>
<pre><code>    DECLARE
         --Declaración de variables
      BEGIN
        LOOP
          --Código que se desea ejecutar
          EXIT WHEN    --Condición de paro
    END LOOP;
</code></pre>
<h2 is-upgraded>WHILE LOOP</h2>
<p>Este tipo de loop permite que se ejecute una sentencia mientras la condición dentro de esta sea verdadera.</p>
<p>Sintaxis:</p>
<pre><code>    WHILE condition LOOP
        --Código que se desea ejecutar
    END LOOP;
</code></pre>
<h2 is-upgraded>WHILE LOOP</h2>
<p>Los loops FOR iteran sobre un rango específico de números enteros. El número de iteraciones se conoce antes de ingresar al loop. El rango se evalúa cuando se ingresa por primera vez el bucle FOR y nunca se vuelve a evaluar.</p>
<pre><code>    BEGIN
        FOR i IN 1 .. 3 LOOP
            -- Código que se desea iterar
            END LOOP;
        END
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Funciones." duration="0">
        <p>Las funciones, como los procedimientos almacenados son bloques de código que permiten agrupar y organizar sentencias SQL que se ejecutan al invocar la función. Una función acepta parámetros, se invoca con su nombre y retorna un valor.</p>
<p>Sintaxis:</p>
<pre><code>    CREATE (OR REPLACE) FUNTION nombre_funcion ( param1 tipo, param2 tipo, ... ) 
    RETURN tipo_dato IS
        -- Declaración de variables locales --
    BEGIN
        -- Instrucciones de ejecución
    [EXCEPTION]
        -- Instrucciones de excepción
    END;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Procedimientos almacenados." duration="0">
        <p>Los procedimientos PL/SQL son subprogramas compuestos por un conjunto de sentencias SQL. Un procedimiento está constituido por un conjunto de sentencias SQL y PL/SQL lógicamente agrupados para realizar una tarea específica. Los procedimientos almacenados constituyen un bloque de código PLSQL que ha sido compilado y almacenado en las tablas del sistema de la base de datos Oracle.</p>
<p>Sintaxis:</p>
<pre><code>    CREATE (OR REPLACE) PROCEDURE nombre_procdimiento} (param1 [IN | OUT | IN OUT] tipo, ... )
    IS
        -- Declaración de variables locales --
    BEGIN
        -- Instrucciones de ejecución
    [EXCEPTION]
        -- Instrucciones de excepción
    END;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Triggers." duration="0">
        <p>Un Trigger se lleva a cabo cuando se produce algún suceso relacionado con la misma. Los triggers pueden utilizarse para completar la integridad referencial, también para imponer reglas de negocio complejas o para auditar cambios en los datos. El código contenido en un trigger denominado cuerpo del trigger, está formado por bloques PL/SQL.</p>
<p>Sintaxis:</p>
<pre><code>    CREATE OR REPLACE TRIGGER nombre_trigger
        BEFORE DELETE OR INSERT OR UPDATE ON tabla
        FOR EACH ROW
    WHEN -- Condición
    DECLARE
        -- Declaración de variables-
    BEGIN
        -- Instrucciones
    END;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Actividad práctica." duration="0">
        <h2 is-upgraded>Ejercicio 1.</h2>
<p>Crear una función que reciba como parámetros dos números enteros, el primer parámetro &#34;venta_objetivo&#34; puede tomar el valor de 5, 10 o 15. El segundo &#34;descuento&#34;, se trata de un numero flotante que puede tomar los valores 0.1, 0.15 o 0.20. La función deberá mostrar la siguiente información de las compras: el id de la factura, el id y nombre del cliente, el id y nombre del empleado, la fecha de la compra y el total de la compra. Además, se debe incluir un criterio extra: para cada compra que cumpla con la cantidad de libros comprados en la &#34;venta_objetivo&#34; o más, se aplicará un valor establecido en el parámetro &#34;descuento&#34;. Por ejemplo, si los parámetros son (5, 0.1), a todas las facturas que tengan una compra de al menos 5 libros se les aplicará un 10% de descuento. La columna muestra el descuento aplicable en cada factura.</p>
<p>Resultado esperado con valores: ventas objetivo=10, descuento=0.1:</p>
<p class="image-container"><img alt="image" title="Solution Ej1" src="img\\f06ea53b7eba9cb0.png"></p>
<h2 is-upgraded>Ejercicio 2.</h2>
<p>Crear una función que reciba como parámetro el id de un departamento, con esta información la función retornará una tabla con la información de todos los empleados que pertenecen a ese departamento. Crear una excepción personalizada para validar que el id se encuentre en el rango de departamentos disponibles, la validación de los departamentos debe realizarse de forma dinámica, para que la función pueda adaptarse ante una posible expansión de los departamentos. No se requiere que la excepción se administre.</p>
<p>Resultado esperado con un id de departamento válido (para el caso, idempleado = 1):</p>
<p class="image-container"><img alt="image" title="Solution Ej2.1" src="img\\b50ef91a436928fa.png"></p>
<p>Resultado esperado con un id de departamento inválido (para el caso, idempleado = 4):</p>
<p class="image-container"><img alt="image" title="Solution Ej2.2" src="img\\af7d07c8b9a942ff.png"></p>
<h2 is-upgraded>Ejercicio 3.</h2>
<p>Crear un procedimiento almacenado que tenga un parámetro de entrada en donde se recibirá el código de un autor, el procedimiento imprimirá en consola toda la información del autor, incluyendo la información de todos sus libros correspondientes. El formato que se ha establecido para poder imprimir la información es JSON.</p>
<p>La siguiente figura muestra el resultado al ejecutar el procedimiento almacenado tomando al autor con id 9 como ejemplo:</p>
<p class="image-container"><img alt="image" title="Solution Ej3" src="img\\4aacebdd84742cfa.png"></p>
<aside class="special"><p><strong>Nota:</strong></p>
<p> Si se desea verificar el formato del resultado de una forma más amigable, es <br> posible utilizar herramientas online como: </p>
<p><a href="https://jsonformatter.curiousconcept.com/" target="_blank">https://jsonformatter.curiousconcept.com/</a></p>
</aside>
<p class="image-container"><img alt="image" title="Solution Ej3.1" src="img\\f65376d65a16886a.png"></p>
<h2 is-upgraded>Diagrama relacional para la actividad.</h2>
<p class="image-container"><img alt="image" title="DiagramaR" src="img\\364ff63e0468b7ba.png"></p>


      </google-codelab-step>
    
      <google-codelab-step label="Sobre los autores de esta guía práctica" duration="0">
        <p><strong>Autores:</strong></p>
<p><strong>Versión 1:</strong> Fátima Adriana Renderos (00064018@uca.edu.sv), Madeline Abigail Clará (00146318@uca.edu.sv), Erick Varela Guzmán (evarela@uca.edu.sv)</p>
<p><strong>Versión 2:</strong> Brian Darwin Carranza Campos (00136020@uca.edu.sv), Alejandro Ernesto Cerón (00040116@uca.edu.sv)</p>
<p><strong>Responsables:</strong> Erick Varela Guzmán (evarela@uca.edu.sv), Correspondencia: evarela@uca.edu.sv</p>
<p>Departamento de Electrónica e Informática, Universidad Centroamericana José Simeón Cañas, La Libertad, El Salvador.</p>
<p>Versión de este documento: Versión 2, 2022.</p>
<p><img alt="test" src="img\\2d61b47ed7775e46.jpg"> This work is licensed under a <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License</a>.</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/claat-public/native-shim.js"></script>
  <script src="https://storage.googleapis.com/claat-public/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/claat-public/prettify.js"></script>
  <script src="https://storage.googleapis.com/claat-public/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
